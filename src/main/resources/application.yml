spring:
  datasource:
    url: jdbc:postgresql://postgres:5432/language_learning
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000
      max-lifetime: 1200000
      auto-commit: true
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          batch_size: 50
          fetch_size: 50
        query:
          in_clause_parameter_padding: true
        order_updates: true
        batch_versioned_data: true
    defer-datasource-initialization: true
  sql:
    init:
      mode: always
  cache:
    type: none
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com
      chat:
        options:
          model: gpt-3.5-turbo
          temperature: 0.3
          max-tokens: 500
  autoconfigure:
    exclude: []

server:
  port: 8080

logging:
  level:
    org.springframework.ai: DEBUG
    com.example.languagelearning.service.AiGrammarValidationService: DEBUG
    com.example.languagelearning.config.AiPromptsConfig: DEBUG
    org.springframework.cache: TRACE
    org.springframework.data.redis: DEBUG
    com.example.languagelearning: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

cors:
  allowed-origins:
    - "http://localhost:3000"
    - "https://language-learning-frontend.railway.app"
    - "https://language-learning-frontend-production.up.railway.app"
    - "https://www.langlearn.top"
    - "https://langlearn.top"

redis:
  host: redis.railway.internal
  port: 6379
  password: kTXzUzQxUWxPwOyoJlzCjDjBGmZzMasy
  database: ${REDIS_DATABASE:0}
  timeout: 2000
  ssl:
    enabled: true
  lettuce:
    pool:
      max-active: 8
      max-idle: 8
      min-idle: 0
      max-wait: -1

ai:
  grammar:
    validation:
      main-prompt: |
        You are an English grammar teacher. Your task is to validate if a student's sentence is correct according to the given grammar topic and contains the required word.
        
        Student's sentence: "%s"
        Required word to use: "%s" (translation: "%s")
        Grammar topic: "%s"
        
        Please analyze the sentence and respond in the following JSON format:
        {
            "isCorrect": true/false,
            "feedback": "Brief feedback about the sentence",
            "correction": "Corrected version of the sentence (if incorrect)",
            "explanation": "Detailed explanation of the grammar rules applied"
        }
        
        CRITICAL RULES:
        1. The sentence MUST demonstrate the specific grammar topic structure FIRST
        2. The sentence MUST contain the required word (either original or translation)
        3. If the sentence does not use the required grammar topic, it is ALWAYS INCORRECT
        4. Grammar topic validation takes PRIORITY over word usage
        5. A sentence using Present Simple when Third Conditional is required is WRONG
        6. A sentence using Present Continuous when Second Conditional is required is WRONG
        7. A sentence using Past Simple when Present Perfect is required is WRONG
        
        VALIDATION PROCESS (ORDER MATTERS):
        1. FIRST: Check if the sentence uses the required grammar topic structure
        2. SECOND: Only if grammar topic is correct, check if the required word is present
        3. THIRD: Only if both conditions are met, check for other grammar correctness
        4. If the grammar topic is wrong, mark as incorrect and provide correction using the required topic
        
        Examples of what makes a sentence INCORRECT:
        - Topic: "Third Conditional" but sentence: "I like coffee" (Present Simple) → WRONG
        - Topic: "Present Perfect" but sentence: "I went to school" (Past Simple) → WRONG
        - Topic: "First Conditional" but sentence: "I will go home" (Future Simple) → WRONG
        - Topic: "Second Conditional" but sentence: "The computer is running slow" (Present Continuous) → WRONG
        - Topic: "Second Conditional" but sentence: "I am working hard" (Present Continuous) → WRONG
        
        Examples of what makes a sentence CORRECT:
        - Topic: "Third Conditional" and sentence: "If I had studied, I would have passed" → CORRECT
        - Topic: "Present Perfect" and sentence: "I have finished my work" → CORRECT
        - Topic: "First Conditional" and sentence: "If it rains, I will stay home" → CORRECT
        - Topic: "Second Conditional" and sentence: "If I had money, I would buy a car" → CORRECT
        
        Examples of CORRECTIONS (when sentence is wrong):
        - Topic: "Past Simple", word: "disaster", wrong sentence: "I am happy" → Correction: "The party was a disaster"
        - Topic: "Second Conditional", word: "sluggish", wrong sentence: "I am working" → Correction: "If I were sluggish, I would work slowly"
        - Topic: "Present Perfect", word: "finished", wrong sentence: "I went home" → Correction: "I have finished my work"
        
        Grammar topics and their rules:
        - Present Simple: Subject + base verb (add 's' for 3rd person singular)
        - Present Continuous: Subject + be (am/is/are) + verb + ing
        - Past Simple: Subject + past form of verb
        - Past Continuous: Subject + was/were + verb + ing
        - Present Perfect: Subject + have/has + past participle
        - Past Perfect: Subject + had + past participle
        - Future Simple: Subject + will + base verb
        - First Conditional: If + present simple, will + base verb
        - Second Conditional: If + past simple, would + base verb
        - Third Conditional: If + past perfect, would have + past participle
        - Passive Voice: Subject + be + past participle
        - Modal Verbs: Subject + modal verb + base verb
        - Gerunds and Infinitives: verb + ing or to + base verb
        - Relative Clauses: Noun + relative pronoun + clause
        - Reported Speech: Subject + reporting verb + that + reported clause
        
        CRITICAL VALIDATION CHECKLIST:
        Before marking a sentence as correct, verify:
        □ Does the sentence use the EXACT grammar topic structure required?
        □ Does the sentence contain the required word?
        □ Is the grammar topic validation the FIRST priority?
        
        CORRECTION RULES:
        - The correction MUST be in ENGLISH (the same language as the required word)
        - The correction MUST use the required grammar topic structure
        - The correction MUST contain the required word (either original or translation)
        - If the original sentence was correct, return the original sentence as correction
        - If the original sentence was incorrect, provide a corrected English sentence
        
        IMPORTANT: 
        - If the sentence does not use the required grammar topic, it is ALWAYS incorrect
        - Grammar topic validation takes ABSOLUTE PRIORITY over word usage
        - The correction must use the required grammar topic
        - Do not accept sentences that ignore the grammar topic requirement
        - Present Continuous ≠ Second Conditional (these are completely different structures)
        - NEVER translate to Polish or other languages - keep corrections in English
        
        Respond only with valid JSON.
      
      grammar-explanations:
        present-simple: |
          Present Simple is used for habits, routines, and general truths.
          
          Structure: Subject + base verb (add 's' for 3rd person singular)
          Examples:
          • I work every day.
          • She works in an office.
          • They like coffee.
          • He doesn't like tea.
        
        present-continuous: |
          Present Continuous is used for actions happening now or around now.
          
          Structure: Subject + be (am/is/are) + verb + ing
          Examples:
          • I am working now.
          • She is reading a book.
          • They are studying English.
          • We are not sleeping.
        
        past-simple: |
          Past Simple is used for completed actions in the past.
          
          Structure: Subject + past form of verb (regular: +ed, irregular: special form)
          Examples:
          • I worked yesterday.
          • She went to the store.
          • They studied all night.
          • He didn't like the movie.
        
        past-continuous: |
          Past Continuous is used for actions that were in progress at a specific time in the past.
          
          Structure: Subject + was/were + verb + ing
          Examples:
          • I was working when you called.
          • She was reading a book at 8 PM.
          • They were studying all night.
          • We were not sleeping during the storm.
        
        present-perfect: |
          Present Perfect is used for actions that started in the past and continue to the present.
          
          Structure: Subject + have/has + past participle
          Examples:
          • I have worked here for 5 years.
          • She has finished her homework.
          • They have never been to Paris.
          • We haven't seen that movie.
        
        past-perfect: |
          Past Perfect is used for actions that happened before another past action.
          
          Structure: Subject + had + past participle
          Examples:
          • I had finished my work before she arrived.
          • She had already eaten when I called.
          • They had never seen such a beautiful sunset.
          • We hadn't met before the party.
        
        future-simple: |
          Future Simple is used for predictions and spontaneous decisions.
          
          Structure: Subject + will + base verb
          Examples:
          • I will help you with that.
          • She will be here tomorrow.
          • They will probably come to the party.
          • We won't be late.
        
        first-conditional: |
          First Conditional is used for real possibilities in the future.
          
          Structure: If + present simple, will + base verb
          Examples:
          • If it rains, I will stay home.
          • If you study hard, you will pass the exam.
          • She will be happy if you call her.
          • We will go to the beach if the weather is nice.
        
        second-conditional: |
          Second Conditional is used for unreal or hypothetical situations.
          
          Structure: If + past simple, would + base verb
          Examples:
          • If I had money, I would buy a car.
          • If you studied more, you would get better grades.
          • She would travel the world if she could.
          • We would be rich if we won the lottery.
        
        third-conditional: |
          Third Conditional is used for unreal situations in the past.
          
          Structure: If + past perfect, would have + past participle
          Examples:
          • If I had studied harder, I would have passed the exam.
          • If she had known, she would have told us.
          • They would have won if they had played better.
          • We would have been rich if we had invested earlier.
        
        passive-voice: |
          Passive Voice is used when the focus is on the action, not the doer.
          
          Structure: Subject + be + past participle (+ by + agent)
          Examples:
          • The book was written by Shakespeare.
          • The house is being built.
          • The letter has been sent.
          • The car was stolen last night.
        
        modal-verbs: |
          Modal Verbs express ability, possibility, permission, obligation, and advice.
          
          Structure: Subject + modal verb + base verb
          Common modal verbs: can, could, may, might, must, shall, should, will, would
          Examples:
          • I can speak English.
          • You should study harder.
          • She must finish her work.
          • They might come to the party.
          • We could help you with that.
        
        gerunds-and-infinitives: |
          Gerunds and Infinitives are verb forms used as nouns.
          
          Gerund Structure: verb + ing (used as subject, object, after prepositions)
          Infinitive Structure: to + base verb (used after certain verbs, adjectives)
          Examples:
          • I enjoy reading books. (gerund)
          • She wants to learn English. (infinitive)
          • Swimming is good exercise. (gerund as subject)
          • It's important to study regularly. (infinitive)
        
        relative-clauses: |
          Relative Clauses provide additional information about a noun.
          
          Structure: Noun + relative pronoun (who, which, that, where, when) + clause
          Examples:
          • The man who lives next door is a doctor.
          • The book that I bought is very interesting.
          • The place where I grew up is beautiful.
          • The time when we met was perfect.
        
        reported-speech: |
          Reported Speech is used to report what someone said.
          
          Structure: Subject + reporting verb + that + reported clause (tense changes)
          Examples:
          • She said that she was tired.
          • He told me that he would come.
          • They mentioned that they had finished.
          • I asked if she could help.
        
        default: |
          Practice using this grammar structure in your sentences.
          
          Make sure to use the given word in your sentence and apply the grammar topic correctly.

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# OpenAI Configuration
openai:
  api:
    key: ${OPENAI_API_KEY:} 